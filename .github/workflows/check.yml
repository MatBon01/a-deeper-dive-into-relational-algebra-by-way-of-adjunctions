name: checks
on: push

jobs:
  spell:
    name: Spell checker
    runs-on: ubuntu-latest
    steps:
      - name: Set spell status to pending
        uses: Sibz/github-status-action@v1
        with:
          authToken: ${{secrets.GITHUB_TOKEN}}
          context: "cli"
          description: "Spell check"
          state: "pending"
      - uses: actions/checkout@v3
      - name: Update packages
        run: sudo apt-get update
      - name: Install spellchecker and dictionary
        run: sudo apt-get install -y hunspell hunspell-en-gb
      - name: Check spelling
        id: spellcheck
        run: |
          echo "numSpellingErrors="$(make -s spell | wc -l) >> $GITHUB_OUTPUT
          echo "spellingErrorList<<EOF" >> $GITHUB_OUTPUT
          make spell >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      - name: Report no errors
        run: echo "::notice title=Spell report::No spelling errors detected"
        if: steps.spellcheck.outputs.numSpellingErrors == 0
      - name: Set spell status to passed if no spelling errors
        uses: Sibz/github-status-action@v1
        with:
          authToken: ${{secrets.GITHUB_TOKEN}}
          context: "cli"
          description: "Spell check"
          state: "success"
        if: steps.spellcheck.output.numSpellingErrors == 0
      - name: Report errors
        run: echo "::warning title=Spell report::$(format('{0} spelling errors detected{1} {2}', steps.spellcheck.outputs.numSpellingErrors, ':', steps.spellcheck.outputs.spellingErrorList))"
        if: steps.spellcheck.output.numSpellingErrors > 0
      - name: Set spell status to failure if there are spelling errors
        uses: Sibz/github-status-action@v1
        with:
          authToken: ${{secrets.GITHUB_TOKEN}}
          context: "cli"
          description: "Spell check"
          state: "failure"
        if: steps.spellcheck.output.numSpellingErrors > 0
  lint:
    name: Linter
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Update packages
        run: sudo apt-get update
      - name: Install linter
        run: sudo apt-get install -y chktex
      - name: Run linter
        run: make lint