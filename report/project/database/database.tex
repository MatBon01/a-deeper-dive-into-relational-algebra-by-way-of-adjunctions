\chapter{Database implementation}\label{chap:database}
This chapter will describe the implementation of the database system outlined in
\relalg{}. The aims of the chapter are to highlight key implementations of the
algorithms of the paper. The purpose of implementing the structures in the paper
are to benchmark and so a high level pragmatic approach is taken in order to
create a working system that can easily be benchmarked.

The structure of the database management system implemented in this
project is a library based off of the code in
\relalg{}~\cite{RelationalAlgebraByWayOfAdjunctions} especially the appendix.
This chapter describes the code needed to create a fully functioning
system as well as highlights my contributions.

\paragraph{Bags} In order to construct the database system an
implementation of a bag (also known as multiset) data structure is
required. Fleshing out the $Bag$ type is one of the main challenges and
contributions of this project in the area of implementing the database. We
base the bag type off a list as the list allows multiple elements and
define an equality function.

\input{code/bagDefAndEquality.tex}

\noindent
It is worth noting that the equality must be defined in such a way that does not
pay attention to the order of elements in the bag. We first create a helper
function $eq'$ that checks equality on lists $xs$ and $ys$ up to permutation.
Given that $xs$ is not empty we check whether $ys$ is non-empty as otherwise
equality would not be possible. If $ys$ has an element, we split the list into
two parts where the head of $xs$ is the first element of the second half of
$ys$. We can then `remove' that element from $ys$, reconstruct the list and
recursively check equality.

As well as defining equality it is also important create instances of $Monad$ and
$Functor$ type classes for the bag type. A bag's status as a functor allows $fmap$s
(the parallel to a projection as seen in \fref{sec:background:dbrep}) to be performed on
them and monad type is important to allow monad comprehensions which was a key
motivating factor for the paper \relalg{}. Details of the implementations are
left out of this paper as they follow the structure of using the instances on
the underlying list and translating the results back to a bag.
